<html>

<head>
    <script class="jsbin" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <script class="jsbin" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.0/jquery-ui.min.js"></script>
    
</head>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js"></script>
<script>
    let classes = ['Anger', 'Disgust', 'Fear', 'Happy', 'Sad', 'Surprise', 'Neutral']
    let model;
    async function f() {
        model = await tf.loadLayersModel(
            'https://demo-bucket-saju.s3.amazonaws.com/js/model.json'
        ).then((m) => {
            console.log("Done ")
            m.summary()
            var pic = document.getElementById('my_image')
            var input = tf.browser.fromPixels(pic, 1).expandDims(0);
            var prediction = m.predict(input);
            console.log("Prediction: ", prediction.dataSync());
            console.log("Winner: ", classes[prediction.argMax().dataSync()[0]])
        });
    }

    async function getFileNameWithExt(event) {
        if (!event || !event.target || !event.target.files || event.target.files.length === 0) {
            return;
        }

        var image = document.getElementById("my_image");
        image.src = URL.createObjectURL(event.target.files[0]);

        image.onload = async function () {
            console.log("Image Loaded.");
            f();
        }

    }
    console.log("Start")
   
    // window.onload = f();

</script>


<body>
    <p>Click on the "Choose File" button to upload a file:</p>

    <input id='inputfile' type='file' name='inputfile' onChange='getFileNameWithExt(event)'><br>
    <br><br>

    <img id="my_image" src="#" alt="your image" />

    <br />



</body>

</html>